(()=>{"use strict";var e,t,a={4453:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SystemApi=void 0;const n=i(a(4602)),s=i(a(9358)),o=a(5600);t.SystemApi=class{constructor(e){this.baseUrl=e,this.checkStatusEndpoint=e+"v2/status",this.checkUpdateEndpoint=e+"v2/update"}async getServiceStatus(){const e=this.checkStatusEndpoint+"?"+new URLSearchParams({...n.default});try{const t=await(0,o.fetchWithTimeout)(e,{method:"GET",timeout:8e3});return t.ok?await t.json():(s.default.warn("Status request failed",t),null)}catch(e){return null}}async checkUpdate(){const e=this.checkUpdateEndpoint+"?"+new URLSearchParams({...n.default});try{const t=await(0,o.fetchWithTimeout)(e,{method:"GET"});return t.ok?await t.json():(s.default.warn("Update check request failed",t),null)}catch(e){return null}}}},4602:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={client:"2.2.0"}},9652:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initCommonApi=void 0;const i=a(4453);t.initCommonApi=async function(e){return{systemApi:new i.SystemApi(e.serviceUrl)}}},1907:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HttpError=void 0,t.HttpError=class{constructor(e,t){this.statusCode=e,this.statusMessage=t}}},111:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.bindFeatureFlagServiceToBus=t.FeatureFlagService=void 0;const n=a(3023),s=a(2159),o=i(a(8030));t.FeatureFlagService=class{constructor(e,t){this.flagStorage=e,this.flagsApi=t}async isEnabled(e){if(e.isLocal)return e.isEnabled||!1;const t=await this.getFlagData(e);return t?.enabled||!1}async getFlagData(e){const t=await this.getFlagsData();if(null==t)return null;const a=t.flags.find((t=>t.name===e.name));if(a){if((Date.now()-t.lastUpdate)/1e3>=a.ttl){const t=await this.updateFlagsFromRemote();if(null!=t){const a=t?.flags.find((t=>t.name===e.name));return a||null}}return a}return null}async getFlagsData(){const e=await this.flagStorage.get();if(null==e)return await this.updateFlagsFromRemote();if((Date.now()-e.lastUpdate)/1e3>e.ttl){const e=await this.updateFlagsFromRemote();if(null!=e)return e}return e}async updateFlagsFromRemote(){const e=(await(0,s.runCatching)((()=>this.flagsApi.getFeatureFlags()))).getOrNull();if(null==e)return null;{const t={flags:e.flags,ttl:e.ttl,lastUpdate:Date.now()};return await this.flagStorage.set(t),t}}},t.bindFeatureFlagServiceToBus=function(e,t){e.bind(o.default.IsEnabled,n.isFeatureFlag,(e=>(0,s.runCatching)((()=>t.isEnabled(e)))))}},919:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureFlagServiceBackground=void 0;const n=i(a(8030)),s=a(2159);t.FeatureFlagServiceBackground=class{constructor(e){this.bus=e}async isEnabled(e){return(0,s.toResult)(await this.bus.publishLocally(n.default.IsEnabled,e)).getOrThrow()}}},2129:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureFlagStorage=void 0;const i=a(6366),n=a(483);class s extends n.CachingPersistentStorage{constructor(){super(i.isFeatureFlagsData,"featureFlagsData")}}t.FeatureFlagStorage=s},1921:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(4602)),s=a(1907),o=a(6720),r=a(5600);t.default=class{constructor(e,t){this.authService=t,this.featureFlagsEndpoint=e+"v2/feature-flags"}async getFeatureFlags(){const e=this.featureFlagsEndpoint+"?"+new URLSearchParams(n.default),t={},a=await this.authService.getAccessToken();null!=a&&(t["X-Api-Key"]=a);const i=await(0,r.fetchWithTimeout)(e,{timeout:2e3,method:"GET",headers:t});if(!i.ok)throw new s.HttpError(i.status,i.statusText);const u=await i.json();if((0,o.isRemoteFeatureFlagsData)(u))return u;throw{message:"Invalid api response",response:u}}}},4152:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initFeatureFlags=void 0;const n=a(2129),s=a(111),o=i(a(1921));t.initFeatureFlags=async function(e){const t=new n.FeatureFlagStorage,a=new o.default(e.serviceUrl,e.authService),i=new s.FeatureFlagService(t,a);return(0,s.bindFeatureFlagServiceToBus)(e.bus,i),{featureFlagService:i}}},3023:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureFlag=void 0;const i=a(2166),n=a(7744),s=a(5643);t.isFeatureFlag=function(e){return(0,n.isObject)(e)&&(0,s.hasStringProperty)(e,"name")&&(0,i.hasBooleanProperty)(e,"isLocal")}},6366:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureFlagsData=t.isFeatureFlagData=void 0;const i=a(5923),n=a(2166),s=a(3735),o=a(7744),r=a(5643);function u(e){return(0,o.isObject)(e)&&(0,r.hasStringProperty)(e,"name")&&(0,n.hasBooleanProperty)(e,"enabled")&&(0,s.hasNumberProperty)(e,"ttl")}t.isFeatureFlagData=u,t.isFeatureFlagsData=function(e){return(0,o.isObject)(e)&&(0,i.hasArrayProperty)(e,"flags",u)&&(0,s.hasNumberProperty)(e,"lastUpdate")&&(0,s.hasNumberProperty)(e,"ttl")}},6720:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isRemoteFeatureFlagsData=void 0;const i=a(5923),n=a(3735),s=a(7744),o=a(6366);t.isRemoteFeatureFlagsData=function(e){return(0,s.isObject)(e)&&(0,i.hasArrayProperty)(e,"flags",o.isFeatureFlagData)&&(0,n.hasNumberProperty)(e,"ttl")}},8924:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(9358)),s=i(a(859)),o=i(a(6815)),r=a(3109),u=a(5263),l={widgetToggleHotkey:"esc",widgetToggleDoubleClick:!0,hideWidgetByDefault:!1,hideNotifications:!1};t.default=class{async init(e){e.bind(s.default.GetSettings,r.isNever,(e=>this.getSettings())),e.bind(s.default.SetSettings,u.isSettings,(e=>{this.setSettings(e)})),this.bus=e,n.default.info("SettingService: initialized")}async setSettings(e){await o.default.storage.local.set({settings:e}),this.bus.publishToActiveTab(s.default.SettingsUpdated,e),this.bus.publishLocally(s.default.SettingsUpdated,e),n.default.info("SettingService: settings updated",e)}async getSettings(){const e=await o.default.storage.local.get({settings:l});return(0,u.isSettings)(e.settings)?e.settings:{...e.settings,...l}}}},11:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initCommonSettings=void 0;const n=i(a(8924));t.initCommonSettings=async function(e){const t=new n.default;await t.init(e.bus)}},483:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CachingPersistentStorage=void 0;const i=a(8674),n=a(9789);class s extends i.LocalStorage{constructor(e,t){super(e,t),this.inMemoryStorage=new n.InMemoryStorage(e)}async get(){const e=await this.inMemoryStorage.get();return null!=e?e:super.get()}async set(e){await super.set(e),await this.inMemoryStorage.set(e)}async clear(){await super.clear(),await this.inMemoryStorage.clear()}}t.CachingPersistentStorage=s},9789:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InMemoryStorage=void 0;const n=i(a(9358));t.InMemoryStorage=class{constructor(e){this.typeGuard=e,this.inMemoryCache=void 0}async clear(){this.inMemoryCache=void 0}async get(){return null==this.inMemoryCache?null:this.typeGuard(this.inMemoryCache)?this.inMemoryCache:(n.default.error("Could not get data from memory storage: validation failed.",{},this.inMemoryCache),null)}async set(e){this.typeGuard(e)?this.inMemoryCache=e:n.default.error("Could not save data to memory storage: validation failed.",{},e)}}},8674:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorage=void 0;const n=i(a(6815)),s=i(a(9358));class o{constructor(e,t){this.typeGuard=e,this.key=t}async get(){const e={};e[this.key]=o.UNDEFINED_VALUE;const t=await n.default.storage.local.get(e);return t[this.key]==o.UNDEFINED_VALUE?null:this.typeGuard(t[this.key])?t[this.key]:(s.default.error(`Could not get data from local storage for the key '${this.key}': validation failed.`,{},t),this.clear(),null)}async set(e){if(this.typeGuard(e)){const t={};t[this.key]=e,await n.default.storage.local.set(t)}else s.default.error(`Could not save data to local storage for the key '${this.key}': validation failed.`,{},e)}async clear(){await n.default.storage.local.remove(this.key)}}t.LocalStorage=o,o.UNDEFINED_VALUE="9o15gfQAJbg-undefined-5a5RemYzWXw7I0"},5923:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasArrayProperty=void 0;const i=a(2938);t.hasArrayProperty=function(e,t,a){return t in e&&(0,i.isArray)(e[t],a)}},430:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNumberOrNull=void 0,t.isNumberOrNull=function(e){return"number"==typeof e||null==e}},1791:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasNumberOrNullProperty=void 0;const i=a(430);t.hasNumberOrNullProperty=function(e,t){return t in e&&(0,i.isNumberOrNull)(e[t])}},8642:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isStringOrNull=void 0,t.isStringOrNull=function(e){return"string"==typeof e||null==e}},8267:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasStringOrNullProperty=void 0;const i=a(8642);t.hasStringOrNullProperty=function(e,t){return t in e&&(0,i.isStringOrNull)(e[t])}},5600:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fetchWithTimeout=void 0,t.fetchWithTimeout=async function(e,t={}){const{timeout:a=8e3}=t,i=new AbortController,n=setTimeout((()=>i.abort()),a),s=await fetch(e,{...t,signal:i.signal});return clearTimeout(n),s}},8910:(e,t,a)=>{const i=a(5045),n=a(4878),s=a(7325),o=a(11),r=a(9652),u=a(5560),l=a(1081),d=a(9476),c=a(4152);i.Tracker.init(),async function(){const e={...l.BusModule,...d.ServiceModule},t={...await(0,r.initCommonApi)(e),...await(0,n.initAccountFeature)(e)},a={...e,...t};await(0,o.initCommonSettings)(e),await(0,s.initMessagesFeature)(a),await(0,c.initFeatureFlags)(a),await(0,u.initQuizFeature)(a)}()},1081:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BusModule=void 0;const n=i(a(1857));t.BusModule={bus:n.default.getInstance()}},9476:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceModule=void 0,t.ServiceModule={serviceUrl:"https://syncshare.naloaty.me/api/",accountsUrl:"https://syncshare.naloaty.me/api/"}},7174:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(5600),s=a(2666),o=a(8348),r=a(1402),u=a(1907),l=i(a(4602));t.default=class{constructor(e,t){this.authService=t,this.userDataEndpoint=e+"v2/account/user",this.accountEditionEndpoint=e+"v2/account/edition"}async getUserData(){const e=this.userDataEndpoint+"?"+new URLSearchParams({...l.default}),t={},a=await this.authService.getAccessToken();null!=a&&(t["X-Api-Key"]=a);const i=await(0,n.fetchWithTimeout)(e,{method:"GET",headers:t});if(401==i.status)throw new r.UnauthorizedError;if(!i.ok)throw new u.HttpError(i.status,i.statusText);const o=await i.json();if((0,s.isUserData)(o))return o;throw{message:"Invalid api response",response:o}}async getAccountEdition(e){const t=this.accountEditionEndpoint+new URLSearchParams({...l.default}),a={"Content-Type":"application/json"},i=await this.authService.getAccessToken();null!=i&&(a["X-Api-Key"]=i);const s=await(0,n.fetchWithTimeout)(t,{method:"POST",headers:a,body:JSON.stringify(e)});if(401==s.status)throw new r.UnauthorizedError;if(!s.ok)throw new u.HttpError(s.status,s.statusText);const d=await s.json();if((0,o.isEditionSchema)(d))return d;throw{message:"Invalid api response",response:d}}}},4804:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(5600),s=a(1402),o=a(1907),r=i(a(4602)),u=a(8079),l=a(8277);t.default=class{constructor(e){this.baseUrl=e,this.loginEndpoint=e+"v2/auth/login",this.refreshEndpoint=e+"v2/auth/refresh",this.logoutEndpoint=e+"v2/auth/logout",this.loginQrEndpoint=e+"v2/auth/qr_login",this.authQrEndpoint=e+"v2/auth/qr_auth"}async login(e){const t=this.loginEndpoint,a=await(0,n.fetchWithTimeout)(t,{method:"POST",body:JSON.stringify({username:e.username,password:e.password,short_lived:e.hiddenMode,...r.default}),headers:{"Content-Type":"application/json"}});if(401==a.status)throw new s.UnauthorizedError;if(!a.ok)throw new o.HttpError(a.status,a.statusText);const i=await a.json();if((0,u.isLoginSchema)(i))return i;throw{message:"Invalid api response",response:i}}async logout(e){const t=this.logoutEndpoint,a=await(0,n.fetchWithTimeout)(t,{method:"POST",body:JSON.stringify({refresh_token:e,...r.default}),headers:{"Content-Type":"application/json"}});if(401==a.status)throw new s.UnauthorizedError;if(!a.ok)throw new o.HttpError(a.status,a.statusText);await a.json()}async refresh(e){const t=this.refreshEndpoint,a=await(0,n.fetchWithTimeout)(t,{method:"POST",body:JSON.stringify({refresh_token:e,...r.default}),headers:{"Content-Type":"application/json"}});if(401==a.status)throw new s.UnauthorizedError;if(!a.ok)throw new o.HttpError(a.status,a.statusText);const i=await a.json();if((0,u.isLoginSchema)(i))return i;throw{message:"Invalid api response",response:i}}async qrLogin(e){const t=this.loginQrEndpoint,a=await(0,n.fetchWithTimeout)(t,{method:"POST",body:JSON.stringify({qr_data:e.qr_data,timeout:e.timeout,short_lived:e.hiddenMode,...r.default}),headers:{"Content-Type":"application/json"},timeout:1e3*(e.timeout+1)});if(401==a.status)throw new s.UnauthorizedError;if(!a.ok)throw new o.HttpError(a.status,a.statusText);const i=await a.json();if((0,u.isLoginSchema)(i))return i;throw{message:"Invalid api response",response:i}}async qrAuth(){const e=this.authQrEndpoint+"?"+new URLSearchParams({...r.default}),t=await(0,n.fetchWithTimeout)(e,{method:"GET",headers:{"Content-Type":"application/json"}});if(401==t.status)throw new s.UnauthorizedError;if(!t.ok)throw new o.HttpError(t.status,t.statusText);const a=await t.json();if((0,l.isQrDataSchema)(a))return a;throw{message:"Invalid api response",response:a}}}},4878:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initAccountFeature=void 0;const n=a(5221),s=a(8894),o=i(a(4804)),r=a(8580),u=i(a(7174)),l=a(5107);t.initAccountFeature=async function(e){const t=new n.AuthStorage,a=new s.UserStorage,i=new o.default(e.accountsUrl),d=new r.AuthService(i,t),c=new u.default(e.accountsUrl,d),h=new l.AccountService(c,a);return(0,l.bindAccountServiceToBus)(e.bus,h),(0,r.bindAuthServiceToBus)(e.bus,d),{authService:d,accountService:h}}},5107:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bindAccountServiceToBus=t.AccountService=void 0;const i=a(3401),n=a(3109),s=a(6539),o=a(2159);t.AccountService=class{constructor(e,t){this.api=e,this.userStorage=t}async getUserData(){const e=await this.userStorage.get();return null!=e?e:await this.api.getUserData()}async isBenefitsAvailable(e){const t=await this.api.getAccountEdition(e);return t.plus_edition&&!t.restricted}},t.bindAccountServiceToBus=function(e,t){e.bind(s.AccountServiceEvent.GetUserData,n.isNever,(()=>(0,o.runCatching)((()=>t.getUserData())))),e.bind(s.AccountServiceEvent.IsBenefitsAvailable,i.isMoodleData,(e=>(0,o.runCatching)((()=>t.isBenefitsAvailable(e)))))}},5221:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthStorage=void 0;const i=a(483),n=a(95);class s extends i.CachingPersistentStorage{constructor(){super(n.isAuthData,"authData")}}t.AuthStorage=s},8894:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserStorage=void 0;const i=a(2666),n=a(9789);class s extends n.InMemoryStorage{constructor(){super(i.isUserData)}}t.UserStorage=s},95:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAuthData=void 0;const i=a(7744),n=a(5643),s=a(2166);t.isAuthData=function(e){return(0,i.isObject)(e)&&(0,n.hasStringProperty)(e,"accessToken")&&(0,n.hasStringProperty)(e,"refreshToken")&&(0,s.hasBooleanProperty)(e,"shortLived")}},8348:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEditionSchema=void 0;const i=a(7744),n=a(2166),s=a(5643);t.isEditionSchema=function(e){return(0,i.isObject)(e)&&(0,n.hasBooleanProperty)(e,"plus_edition")&&(0,s.hasStringProperty)(e,"restricted")}},8079:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCorrectLoginSchema=t.isLoginSchema=void 0;const i=a(7744),n=a(8267),s=a(2166);function o(e){return(0,i.isObject)(e)&&(0,n.hasStringOrNullProperty)(e,"access_token")&&(0,n.hasStringOrNullProperty)(e,"refresh_token")&&(0,s.hasBooleanProperty)(e,"reset")}t.isLoginSchema=o,t.isCorrectLoginSchema=function(e){return o(e)&&null!=e.refresh_token&&null!=e.access_token}},3401:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMoodleData=void 0;const i=a(7744),n=a(5643);t.isMoodleData=function(e){return(0,i.isObject)(e)&&(0,n.hasStringProperty)(e,"moodle_user")&&(0,n.hasStringProperty)(e,"moodle_host")}},8277:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isQrDataSchema=void 0;const i=a(7744),n=a(5643);t.isQrDataSchema=function(e){return(0,i.isObject)(e)&&(0,n.hasStringProperty)(e,"qr_data")}},2666:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUserData=void 0;const i=a(7744),n=a(5643),s=a(2166);t.isUserData=function(e){return(0,i.isObject)(e)&&(0,n.hasStringProperty)(e,"username")&&(0,s.hasBooleanProperty)(e,"plus_edition")}},8656:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(859)),s=i(a(6815)),o=i(a(9358)),r=a(3109),u={install:{title:s.default.i18n.getMessage("installTitle"),content:s.default.i18n.getMessage("installContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:s.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]},changelog:{title:s.default.i18n.getMessage("changelogTitle"),content:s.default.i18n.getMessage("changelogContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:s.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}};t.default=class{async init(e){e.bind(n.default.GetInstallationMessage,r.isNever,(e=>this.getInstallationMessage())),o.default.info("ChangelogMessage: initialized")}async getInstallationMessage(){const e=await s.default.storage.local.get({installationMessage:"none"});return o.default.info(`ChangelogMessages: Installation message status is '${e.installationMessage}'`),"none"===e.installationMessage?(await s.default.storage.local.set({installationMessage:"2.2.0"}),u.install):"2.2.0"!==e.installationMessage?(await s.default.storage.local.set({installationMessage:"2.2.0"}),u.changelog):null}}},4024:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(9358)),s=i(a(859)),o=i(a(6815)),r=a(3109),u={maintenance:{title:o.default.i18n.getMessage("maintenanceTitle"),content:o.default.i18n.getMessage("maintenanceContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:o.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]},highDemand:{title:o.default.i18n.getMessage("highDemandTitle"),content:o.default.i18n.getMessage("highDemandContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:o.default.i18n.getMessage("Donate"),value:!0,tag:"url",data:"https://syncshare.naloaty.me/#donation",attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:o.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]},unreachable:{title:o.default.i18n.getMessage("serviceUnreachableTitle"),content:o.default.i18n.getMessage("serviceUnreachableContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:o.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}};t.default=class{constructor(e){this.systemApi=e}async init(e){e.bind(s.default.GetStatusMessage,r.isNever,(e=>this.getStatusMessage())),n.default.info("StatusMessage: initialized")}async getStatusMessage(){const e=await this.systemApi.getServiceStatus();return n.default.info(`Service status is '${e}'`),null===e?u.unreachable:e.maintenance?u.maintenance:e.highDemand?u.highDemand:void 0}}},4993:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(9358)),s=i(a(859)),o=i(a(6815)),r=a(3109),u={title:o.default.i18n.getMessage("updateAvailableTitle"),content:o.default.i18n.getMessage("updateAvailableContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:o.default.i18n.getMessage("Update"),value:!0,tag:"url",data:"https://syncshare.naloaty.me/#install",attr:{class:"btn btn-primary","data-dismiss":"modal"}}]};t.default=class{constructor(e){this.systemApi=e}async init(e){e.bind(s.default.GetUpdateMessage,r.isNever,(e=>this.getUpdateMessage())),n.default.info("UpdateMessage: initialized")}async getUpdateMessage(){const e=await this.systemApi.checkUpdate();return null===e?null:e.updateRequired?u:null}}},7325:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initMessagesFeature=void 0;const n=i(a(8656)),s=i(a(4024)),o=i(a(4993));t.initMessagesFeature=async function(e){const t=new n.default,a=new s.default(e.systemApi),i=new o.default(e.systemApi);await t.init(e.bus),await i.init(e.bus),await a.init(e.bus)}},4392:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(9358)),s=i(a(859)),o=i(a(6815)),r=a(2310),u=a(1579),l=a(1422),d=a(1399),c=a(7669);t.default=class{constructor(e){this.quizApi=e}async init(e){n.default.info("AttemptService: initializing..."),o.default.runtime.onStartup.addListener((function(){o.default.storage.local.remove("attemptData"),o.default.storage.local.remove("magicButtonsState"),n.default.debug("AttemptService: Saved state invalidated"),o.default.storage.local.remove("attempts")})),e.bind(s.default.QuizAttemptData,r.isAttemptData,(e=>{this.onAttemptData(e.quizMeta,e.questions)})),e.bind(s.default.QuizReviewData,u.isReviewData,(e=>{this.onReviewData(e.quizMeta,e.questions,e.reviewSummary)})),e.bind(s.default.BoardTableData,d.isBoardTableData,(e=>{this.onBoardTableData(e)})),e.bind(s.default.SolutionRequest,l.isLocalSolutionRequest,(e=>this.onSolutionRequest(e))),e.bind(s.default.CompletionRequest,c.isLocalCompletionRequest,(e=>this.onCompletionRequest(e))),n.default.info("AttemptService: initialized")}onAttemptData(e,t){if(null===e.moodleId||null===e.host||null===e.courseId||null===e.courseName||null===e.quizId||null===e.quizName||null===e.attemptId)return void n.default.warn("Failed to send attempt data: some of the required properties are null.",e);const a={moodleId:e.moodleId,quizMeta:{host:e.host,courseId:e.courseId,courseName:e.courseName,quizId:e.quizId,quizName:e.quizName,attemptId:e.attemptId},questions:t};n.default.debug("AttemptService: Sent attempt data",a),this.quizApi.sendAttemptData(a)}onReviewData(e,t,a){if(null===e.moodleId||null===e.host||null===e.courseId||null===e.courseName||null===e.quizId||null===e.quizName||null===e.attemptId)return void n.default.warn("AttemptService: Failed to send review data: some of the required properties are null.",e);const i={moodleId:e.moodleId,quizMeta:{host:e.host,courseId:e.courseId,courseName:e.courseName,quizId:e.quizId,quizName:e.quizName,attemptId:e.attemptId},questions:t,reviewSummary:a};n.default.debug("AttemptService: Sent review data",i),this.quizApi.sendReviewData(i)}onBoardTableData(e){null!==e.quizMeta.moodleId&&null!==e.quizMeta.host&&null!==e.quizMeta.courseId&&null!==e.quizMeta.courseName&&null!==e.quizMeta.quizId&&null!==e.quizMeta.quizName&&null!==e.quizMeta.attemptId?this.quizApi.sendBoardTableData(e):n.default.warn("Failed to send board table data: some of the required properties are null.",e)}async onSolutionRequest(e){if(null===e.quizMeta.moodleId||null===e.quizMeta.host||null===e.quizMeta.courseId||null===e.quizMeta.quizId||null===e.quizMeta.attemptId)return void n.default.warn("AttemptService: Failed to request solution: some of the required properties are null.",this);const t={host:e.quizMeta.host,courseId:e.quizMeta.courseId.toString(),quizId:e.quizMeta.quizId.toString(),attemptId:e.quizMeta.attemptId.toString(),moodleId:e.quizMeta.moodleId.toString(),questionIdentity:e.questionIdentity,questionType:e.questionType};null!=e.questionId&&(t.questionId=e.questionId.toString()),n.default.debug("AttemptService: Sent solution request",t);const a=await this.quizApi.requestSolution(t);return n.default.debug("AttemptService: Received solution",a),a}async onCompletionRequest(e){const t={host:e.host,quizId:e.quizId.toString()};return await this.quizApi.requestCompletion(t)}}},1854:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(9358)),s=i(a(4602)),o=a(5600),r=a(9977);t.default=class{constructor(e,t){this.baseUrl=e,this.authService=t,this.solutionEndpoint=e+"v2/quiz/solution",this.attemptEndpoint=e+"v2/quiz/attempt",this.reviewEndpoint=e+"v2/quiz/review",this.boardTableEndpoint=e+"v2/quiz/attempt/summary",this.quizCompletionEndpoint=e+"v2/quiz/completion"}async requestCompletion(e){const t=this.quizCompletionEndpoint+"?"+new URLSearchParams({...e,...s.default}),a={},i=await this.authService.getAccessToken();null!=i&&(a["X-Api-Key"]=i);const u=await(0,o.fetchWithTimeout)(t,{method:"GET",headers:a});if(u.ok){const e=await u.json();return(0,r.isCompletionData)(e)?e:void n.default.warn("Completion request failed: Wrong response",u)}n.default.warn("Completion request failed",u)}async requestSolution(e){const t=this.solutionEndpoint+"?"+new URLSearchParams({...e,...s.default}),a={},i=await this.authService.getAccessToken();null!=i&&(a["X-Api-Key"]=i);const r=await(0,o.fetchWithTimeout)(t,{method:"GET",headers:a});return r.ok?await r.json():(n.default.warn("Solution request failed",r),[])}sendAttemptData(e){this.authService.getAccessToken().then((t=>(0,o.fetchWithTimeout)(this.attemptEndpoint,{timeout:2e4,method:"POST",headers:{"Content-Type":"application/json",...null!=t?{"X-Api-Key":t}:{}},body:JSON.stringify({...e,...s.default})}))).then((e=>{if(!e.ok)return n.default.warn("Failed to send attempt data",e),e.json()})).then((e=>{e&&n.default.warn("Response body",e)}))}sendReviewData(e){this.authService.getAccessToken().then((t=>(0,o.fetchWithTimeout)(this.reviewEndpoint,{timeout:2e4,method:"POST",headers:{"Content-Type":"application/json",...null!=t?{"X-Api-Key":t}:{}},body:JSON.stringify({...e,...s.default})}))).then((e=>{if(!e.ok)return n.default.warn("Failed to send review data",e),e.json()})).then((e=>{e&&n.default.warn("Response body",e)}))}sendBoardTableData(e){this.authService.getAccessToken().then((t=>(0,o.fetchWithTimeout)(this.boardTableEndpoint,{timeout:2e4,method:"POST",headers:{"Content-Type":"application/json",...null!=t?{"X-Api-Key":t}:{}},body:JSON.stringify({...e,...s.default})}))).then((e=>{if(!e.ok)return n.default.warn("Failed to send board table data",e),e.json()})).then((e=>{e&&n.default.warn("Response body",e)}))}}},5560:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initQuizFeature=void 0;const n=i(a(1854)),s=i(a(4392)),o=i(a(6815)),r=a(919),u=a(3136),l=i(a(859)),d=i(a(6744));t.initQuizFeature=async function(e){const t=new n.default(e.serviceUrl,e.authService),a=new s.default(t),i=new r.FeatureFlagServiceBackground(e.bus),c=await i.isEnabled(u.FeatureFlags.QuizView);await a.init(e.bus),o.default.contextMenus.removeAll().then((()=>{c&&(o.default.contextMenus.create({id:d.default.QuizView,title:o.default.i18n.getMessage("openQuizViewMessage"),documentUrlPatterns:["*://*/*mod/quiz/view.php*"],contexts:["page"]}),o.default.contextMenus.onClicked.addListener(((t,a)=>{t.menuItemId===d.default.QuizView&&a&&a.id&&e.bus.publishToTab(a.id,l.default.OpenQuizView)})))}))}},2310:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAttemptData=void 0;const i=a(7744),n=a(1547),s=a(2938),o=a(3793);t.isAttemptData=function(e){return(0,i.isObject)(e)&&"quizMeta"in e&&(0,n.isQuizMeta)(e.quizMeta)&&"questions"in e&&(0,s.isArray)(e.questions,o.isUnknown)}},1399:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBoardTableData=void 0;const i=a(4456),n=a(7744),s=a(5643);t.isBoardTableData=function(e){return(0,n.isObject)(e)&&"quizMeta"in e&&(0,i.isPageData)(e.quizMeta)&&(0,s.hasStringProperty)(e,"tableHtml")}},6744:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.QuizView="quiz-view"}(a||(a={})),t.default=a},7669:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLocalCompletionRequest=void 0;const i=a(7744),n=a(3735),s=a(5643);t.isLocalCompletionRequest=function(e){return(0,i.isObject)(e)&&(0,s.hasStringProperty)(e,"host")&&(0,n.hasNumberProperty)(e,"quizId")}},1422:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLocalSolutionRequest=void 0;const i=a(4456),n=a(7744),s=a(5643),o=a(1791);t.isLocalSolutionRequest=function(e){return(0,n.isObject)(e)&&"quizMeta"in e&&(0,i.isPageData)(e.quizMeta)&&(0,o.hasNumberOrNullProperty)(e,"questionId")&&(0,s.hasStringProperty)(e,"questionIdentity")&&(0,s.hasStringProperty)(e,"questionType")}},4456:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPageData=void 0;const i=a(1547);t.isPageData=function(e){return(0,i.isQuizMeta)(e)&&"moodleId"in e}},1547:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isQuizMeta=void 0;const i=a(7744);t.isQuizMeta=function(e){return(0,i.isObject)(e)&&"host"in e&&"courseId"in e&&"courseName"in e&&"quizId"in e&&"quizName"in e&&"attemptId"in e}},1579:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isReviewData=void 0;const i=a(2310);t.isReviewData=function(e){return(0,i.isAttemptData)(e)&&"reviewSummary"in e&&("string"==typeof e.reviewSummary||null===e.reviewSummary)}}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var s=i[e]={id:e,loaded:!1,exports:{}};return a[e].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=a,n.x=()=>{var e=n.O(void 0,[223],(()=>n(8910)));return n.O(e)},e=[],n.O=(t,a,i,s)=>{if(!a){var o=1/0;for(d=0;d<e.length;d++){for(var[a,i,s]=e[d],r=!0,u=0;u<a.length;u++)(!1&s||o>=s)&&Object.keys(n.O).every((e=>n.O[e](a[u])))?a.splice(u--,1):(r=!1,s<o&&(o=s));if(r){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,i,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,a)=>(n.f[a](e,t),t)),[])),n.u=e=>"js/commons.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.j=471,(()=>{var e,t=!!(()=>{try{return browser.runtime.getURL("/")}catch(e){}})(),a=!!(()=>{try{return chrome.runtime.getURL("/")}catch(e){}})(),i=t?browser:a?chrome:{get runtime(){throw new Error("No chrome or browser runtime found")}};n.g.importScripts&&(e=n.g.location+"");var s=n.g.document;!e&&s&&s.currentScript&&(e=s.currentScript.src),e||(e=i.runtime.getURL("/")),e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e+"../"})(),(()=>{var e={471:1};n.f.i=(t,a)=>{e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunksyncshare_extension=self.webpackChunksyncshare_extension||[],a=t.push.bind(t);t.push=t=>{var[i,s,o]=t;for(var r in s)n.o(s,r)&&(n.m[r]=s[r]);for(o&&o(n);i.length;)e[i.pop()]=1;a(t)}})(),(()=>{const e=!!(()=>{try{if("function"==typeof browser.runtime.getURL)return!0}catch(e){}})(),t=e?browser:chrome;t.runtime.onMessage.addListener(((a,i,n)=>{if(!(a&&"WTW_INJECT"===a.type&&i&&i.tab&&null!=i.tab.id))return;let s=a.file;try{s=new URL(s).pathname}catch{}if(s){if(t.scripting)t.scripting.executeScript({target:{tabId:i.tab.id,frameIds:[i.frameId]},files:[s]}).then(n);else{const a={frameId:i.frameId,file:s,matchAboutBlank:!0};e?t.tabs.executeScript(i.tab.id,a).then(n):t.tabs.executeScript(i.tab.id,a,n)}return!0}}))})(),n.f.i(223),t=n.x,n.x=()=>n.e(223).then(t),n.x()})();