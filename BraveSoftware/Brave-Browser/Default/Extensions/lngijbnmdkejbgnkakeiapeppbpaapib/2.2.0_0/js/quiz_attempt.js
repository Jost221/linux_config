(()=>{"use strict";var e,t={2229:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSrcFilename=t.fromImageElementLazy=void 0;const i=n(4025);t.fromImageElementLazy=function(e){const t={src:"",alt:e.alt,data:""};return e.src.startsWith("data:")?t.src=(0,i.hashString)(e.src).toString():t.src=e.src,t},t.getSrcFilename=function(e){const t=e.src.lastIndexOf("/");return-1!==t?e.src.slice(t+1):e.src}},4025:(e,t)=>{function n(e){return e.replace(/^ +| +$|\\n|\n/g,"")}function i(e){let t,n,i=0;if(0===e.length)return i;for(t=0;t<e.length;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i}Object.defineProperty(t,"__esModule",{value:!0}),t.hashQuestionImage=t.hashString=t.cleanString=void 0,t.cleanString=n,t.hashString=i,t.hashQuestionImage=function(e){const t=e.src.lastIndexOf("/"),s={fn:n(-1!==t?e.src.slice(t+1):e.src),alt:e.alt};return i(JSON.stringify(s)).toString()}},1641:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.fuzzyAnchor=void 0;const o=r(n(2787));t.fuzzyAnchor=function(e,t){if(0===t.length)return-1;let n=!1,i=-1,s=1/0;for(let r=0;r<t.length;r++){const a=t[r];let l=1/0;e:for(const t of e)for(const e of a){const n=o.distance(t,e);if(!(n>Math.max(e.length,t.length)/2)&&(n<l&&(l=n),0==n))break e}if(0==l)return r;l<s&&l!=1/0?(i=r,s=l,n=!1):l===s&&l!=1/0&&(n=!0)}return n||-1==i?-1:i}},4508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._visible=!0,this._element=this.createElement()}get visible(){return this._visible}get element(){return this._element}hide(){this.element.style.visibility="hidden",this._visible=!1}show(){this.element.style.visibility="visible",this._visible=!0}toggleVisibility(){this._visible?this.hide():this.show()}}},9766:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContextMenu=void 0;const s=i(n(7007)),r=n(1420),o=(0,r.getGlobalShadowRoot)(),a=(0,r.getExtensionStyle)("/css/widgets/context_menu.css"),l=(0,r.getFontAwesomeLink)();null!==l&&o.append(l),o.append(a);class c extends s.default{get button(){return this._button}constructor(e){super(),this._button=null,this.isShown=!1,this.menu=document.createElement("ul"),this.menu.classList.add("syncshare-cm"),this.menu.hidden=!0,this.constructMenu(this.menu,e),o.appendChild(this.menu),window.addEventListener("resize",(()=>this.hide())),document.addEventListener("click",(e=>{e.target!=this.buttonContainer&&this.hide()})),window.addEventListener("scroll",(()=>this.hide())),document.querySelector("#overview")?.addEventListener("scroll",(()=>this.hide()))}constructMenu(e,t){for(const n of t){const t=this.constructOption(n);if(t.addEventListener("click",(e=>{e.stopPropagation(),n.subMenu||(this.hide(),this.emit("OptionClick",n),n.action&&n.action(n))})),e.appendChild(t),n.subMenu){const e=document.createElement("ul");e.classList.add("sub-menu"),t.appendChild(e),this.constructMenu(e,n.subMenu)}}}constructOption(e){const t=document.createElement("li");t.classList.add("menu-item");const n=document.createTextNode(e.label),i=document.createElement("span");if(i.classList.add("item-label"),i.appendChild(n),t.appendChild(i),e.icon){const n=document.createElement("span"),s=e.icon;if(s.frontColor&&(n.style.color=s.frontColor),s.backColor&&(n.style.backgroundColor=s.backColor),s.name&&!s.text)n.classList.add("icon","fa-fw",...s.name);else if(s.text&&!s.name){const e=document.createTextNode(s.text);n.appendChild(e)}if(s.alignRight){const e=document.createElement("div");e.classList.add("postfix"),n.classList.add("content"),e.appendChild(n),t.appendChild(e)}else n.classList.add("prefix"),t.insertBefore(n,i)}if(e.subMenu&&e.subMenu.length>0){const e=document.createElement("div");e.classList.add("postfix");const n=document.createElement("span");n.classList.add("icon","fa","fa-fw","fa-angle-right","arrow-icon"),e.appendChild(n),t.appendChild(e)}return t}show(e,t){if(this.isShown)return;const{innerWidth:n,innerHeight:i}=window,{offsetWidth:s,offsetHeight:r}=this.menu;let o="0",a="0";this.menu.classList.remove("left"),this.menu.classList.remove("top"),e>=n/4*3&&this.menu.classList.add("left"),t>=i/4*3&&this.menu.classList.add("top"),e>=n-s&&(o="-100%"),t>=i-r&&(a="-100%"),this.menu.style.left=e+"px",this.menu.style.top=t+"px",this.menu.style.transform=`translate(${o}, ${a})`,this.menu.hidden=!1,this.isShown=!0,this.emit("MenuShown")}hide(){this.isShown&&(this.menu.hidden=!0,this.isShown=!1,this.emit("MenuHidden"))}attach(e,t){this._button=e,this.buttonContainer=t,e.element.addEventListener("click",(e=>{e.preventDefault(),this.show(e.clientX,e.clientY)}))}}t.ContextMenu=c},812:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(1877));class r extends s.default{createElement(){const e=document.createElement("span");return e.classList.add("icon","fa","fa-clock-o","fa-fw"),e.style.cursor="pointer",e}}t.default=r},1877:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(4508));class r extends s.default{createElement(){const e=document.createElement("span");return e.classList.add("icon","fa","fa-magic","fa-fw"),e.style.cursor="pointer",e}}t.default=r},2894:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(1877));class r extends s.default{createElement(){const e=document.createElement("span");return e.classList.add("icon","fa","fa-wrench","fa-fw"),e.style.cursor="pointer",e}}t.default=r},5041:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MagicButtonRegistry=void 0;const s=i(n(859)),r=i(n(9358)),o=i(n(3259)),a=i(n(6815)),l=n(5263);t.MagicButtonRegistry=class{constructor(){this.instances=new Set,this.doubleClickListener=()=>this.toggleMagicButtons()}async init(e){const t=await e.publishToBackground(s.default.GetSettings),{magicButtonsState:n}=await a.default.storage.local.get({magicButtonsState:{visibilityOverridden:!1,buttonsVisible:!0}});this.buttonsVisible=n.buttonsVisible,this.visibilityOverridden=n.visibilityOverridden,(0,l.isSettings)(t)?this.applySettings(t):r.default.warn("MagicButtonRegistry: Got invalid settings object.",t),e.listen(s.default.SettingsUpdated,l.isSettings,(e=>{this.applySettings(e)})),r.default.info("MagicButtonRegistry: Initialized")}applySettings(e){this.setupButtonsVisibility(e.hideWidgetByDefault),this.setupHotkey(e.widgetToggleHotkey),this.setupDoubleClick(e.widgetToggleDoubleClick)}setupButtonsVisibility(e){if(!this.visibilityOverridden){this.buttonsVisible=!e;for(const e of this.instances)this.buttonsVisible?e.show():e.hide()}}setupHotkey(e){if(this.toggleHotkey){if(this.toggleHotkey===e)return;o.default.unbind(this.toggleHotkey)}(0,o.default)(e,{keyup:!0,keydown:!0},((e,t)=>{if(!e.repeat&&"keydown"===e.type)return this.toggleMagicButtons(),!1})),this.toggleHotkey=e}setupDoubleClick(e){!e&&this.toggleDoubleClick?window.removeEventListener("dblclick",this.doubleClickListener):e&&!this.toggleDoubleClick&&window.addEventListener("dblclick",this.doubleClickListener),this.toggleDoubleClick=e}toggleMagicButtons(){this.visibilityOverridden=!0;for(const e of this.instances)e.toggleVisibility();this.buttonsVisible=!this.buttonsVisible,a.default.storage.local.set({magicButtonsState:{visibilityOverridden:this.visibilityOverridden,buttonsVisible:this.buttonsVisible}})}register(e){this.instances.add(e),this.buttonsVisible?e.show():e.hide()}}},1292:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const i=n(67),s=n(254),r=n(2229),o=n(4963);class a{constructor(e){const t=e.querySelector("textarea.coderunner-answer");this.control=(0,s.checkNotNull)(t,"Missing textarea element"),this.container=e}getUserInput(){return this.control.value}createWidgetAnchor(){const e=(0,s.checkNotNull)(this.container.querySelector("div.prompt"),"Missing place for magic wand"),t=document.createElement("span");return e.appendChild(t),{container:t,onApply:e=>{navigator.clipboard.writeText(e)},appendPosition:"after"}}}class l extends i.Question{constructor(e){super(e),this.formulationImages=[],this._wanded=!1;const t=(0,s.checkNotNull)(this.container.querySelector("div.formulation"),"Missing .formulation");t.querySelectorAll("img").forEach((e=>{const t=(0,r.fromImageElementLazy)(e);this.formulationImages.push(t)})),this.formulation=t.innerHTML,this.wrapper=new a(this.container);const n=t.cloneNode(!0);n.querySelectorAll(".accesshide").forEach((e=>e.parentElement?.removeChild(e))),this.identityInternal=(0,o.identity)(n.innerText)}createWidgetAnchor(e){return this._wanded=!0,this.wrapper.createWidgetAnchor()}getOrphanContainers(){if(!this._wanded){const e=this.createWidgetAnchor(null);if(e)return[{container:e.container,appendPosition:"after"}]}return[]}get identity(){return this.identityInternal.toString()}get autofillSupported(){return!1}serializeToJSON(){return{...super.serializeToJSON(),formulation:{html:this.formulation,images:this.formulationImages},userInput:this.wrapper.getUserInput(),feedback:this.getFeedback()}}getFeedback(){const e=this.container.querySelector("div.outcome");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=l},8506:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ControlWrapper=void 0;const i=n(67),s=n(4963),r=n(2229),o=n(1641),a=n(4025),l=n(254),c=n(4963);class u{constructor(e){this.options=new Map,this.control=e,this.parent=(0,l.checkNotNull)(this.control.parentElement,"Control's parent is missing"),this.control.childNodes.forEach((e=>{e instanceof HTMLOptionElement&&""!==(0,s.strip)(e.value)&&this.options.set(e.value.toString(),(0,s.strip)(e.innerText))}))}setOption(e){if(0===this.options.size)return;const t=[],n=[];for(const[e,i]of this.options.entries())t.push(e),n.push(i);let i=n.indexOf(e);if(-1===i){const t=(0,s.fuzzyMatch)(e,n);if(null===t)return;i=t.index}this.control.value=t[i]}getOptions(){const e=[];for(const t of this.options.values())e.push(t);return e}getUserInput(){const e=this.options.get(this.control.value),t=null==e?"":e,n=(0,i.getStateFromClassList)(this.parent),s=(0,i.getStateFromClassList)(this.control);let r;return r=n===s?n:n==i.State.Unknown?s:s==i.State.Unknown?n:i.State.Unknown,{option:t,state:r}}createWidgetContainer(){const e=document.createElement("span");return this.parent.appendChild(e),e}}t.ControlWrapper=u;class d{constructor(e){this.anchor=[],this.images=[],this._wanded=!1;const t=(0,l.checkNotNull)(e.querySelector(".text"),"Missing .text"),n=(0,l.checkNotNull)(e.querySelector(".control > select"),"Missing .control");this.wrapper=new u(n),this.text=t.innerHTML,this.widgetHost=t.firstElementChild;const i=(0,s.strip)(t.innerText);""!==i&&this.anchor.push(i),this.identity=(0,c.identity)(i),t.querySelectorAll("img").forEach((e=>{const t=(0,r.fromImageElementLazy)(e);this.images.push(t),this.anchor.push((0,a.hashQuestionImage)(t)),this.identity=(0,s.compoundIdentity)(this.identity,(0,c.identity)((0,r.getSrcFilename)(t)));const n=(0,s.extractFilenameFromUrl)(t.src);n&&this.anchor.push(n)}))}get wanded(){return this._wanded}serializeToJson(){return{html:this.text,images:this.images,userInput:this.wrapper.getUserInput()}}setOption(e){this.wrapper.setOption(e)}createWidgetContainer(){return this._wanded=!0,null!=this.widgetHost?this.widgetHost:this.wrapper.createWidgetContainer()}getOptions(){return this.wrapper.getOptions()}getAnchor(){return this.anchor}getIdentity(){return this.identity}}class h extends i.Question{constructor(e){super(e),this.subquestions=[],this.formulation=new i.QTextWrapper(e),(0,l.checkNotNull)(this.container.querySelector("table.answer"),"Missing .answer table").querySelectorAll("tr").forEach((e=>{this.subquestions.push(new d(e))}))}serializeToJSON(){return{...super.serializeToJSON(),formulation:this.formulation.getFormulation(),subquestions:this.subquestions.map((e=>e.serializeToJson())),options:this.subquestions[0].getOptions(),feedback:this.getFeedback()}}createWidgetAnchor(e){const t=(0,o.fuzzyAnchor)(e,this.subquestions.map((e=>e.getAnchor())));if(-1===t)return null;const n=this.subquestions[t];return{onApply:e=>n.setOption(e),container:n.createWidgetContainer(),appendPosition:"before"}}getOrphanContainers(){const e=[];for(const t of this.subquestions)t.wanded||e.push({container:t.createWidgetContainer(),appendPosition:"before"});return e}get identity(){return(0,s.compoundIdentity)(this.formulation.getIdentity(),...this.subquestions.map((e=>e.getIdentity()))).toString()}get autofillSupported(){return!0}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=h},1692:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const o=n(67),a=r(n(4369)),l=r(n(7759)),c=r(n(8506)),u=n(2229),d=n(254),h=n(4963);var p;function f(e){const t=e.match(/sub(\d+)/),n=e.match(/p(\d+)/),i=t||n,s=(0,d.checkNotNull)(i,"Could not parse subquestion's index");return parseInt(s[1])}!function(e){e.Shortanswer="sa",e.MultichoiceSingle="mc_single",e.MultichoiceSeveral="mc_several",e.Combobox="cb"}(p||(p={}));class g extends a.ContainerWrapper{constructor(e){super(e),this.index=f(this.answerOptions[0].getControl().name),this.__type=this.multipleAnswersAllowed?p.MultichoiceSeveral:p.MultichoiceSingle}serializeToJSON(){return{index:this.index,__type:this.__type,options:this.getOptions(),feedback:this.getFeedback()}}createWidgetAnchor(e){return super.createWidgetAnchor(e)}getFeedback(){const e=this.container.nextElementSibling;return null===e||-1===e.className.indexOf("outcome")?null:e.outerHTML}}class m extends l.ControlWrapper{constructor(e){super(e),this.__type=p.Shortanswer,this.index=f(e.name)}serializeToJSON(){return{index:this.index,__type:this.__type,userInput:this.getUserInput(),feedback:this.getFeedback()}}createWidgetAnchor(){return super.createWidgetAnchor()}getIdentity(){return 0}getFeedback(){const e=this.control.parentElement;if(null===e)return null;const t=e.querySelector("span.feedbackspan");return null===t?null:t.outerHTML}}class b extends c.ControlWrapper{constructor(e){super(e),this.__type=p.Combobox,this._wanded=!1,this.index=f(e.name)}serializeToJSON(){return{index:this.index,__type:this.__type,options:this.getOptions(),userInput:this.getUserInput(),feedback:this.getFeedback()}}getIdentity(){return(0,h.compoundIdentity)(...this.getOptions().map((e=>(0,h.identity)(e))))}createWidgetAnchor(){return this._wanded=!0,{onApply:e=>super.setOption(e),container:this.parent,appendPosition:"after"}}getOrphanContainers(){return this._wanded?[]:[{container:this.parent,appendPosition:"after"}]}getFeedback(){const e=this.control.parentElement;if(null===e)return null;const t=e.querySelector("span.feedbackspan");return null===t?null:t.outerHTML}}class y extends o.Question{constructor(e){super(e),this.formulationImages=[],this.subquestions=new Map;const t=(0,d.checkNotNull)(this.container.querySelector("div.formulation"),"Missing .formulation");t.querySelectorAll("img").forEach((e=>{const t=(0,u.fromImageElementLazy)(e);this.formulationImages.push(t)})),this.formulation=t.innerHTML,this.container.querySelectorAll("div.answer, table.answer, fieldset.answer").forEach((e=>{const t=new g(e);this.subquestions.set(t.index,t)})),this.container.querySelectorAll("select.select").forEach((e=>{const t=new b(e);this.subquestions.set(t.index,t)})),this.container.querySelectorAll('input[type="text"]').forEach((e=>{const t=new m(e);this.subquestions.set(t.index,t)}));const n=t.cloneNode(!0);n.querySelectorAll("div.answer, table.answer, fieldset.answer").forEach((e=>e.parentElement?.removeChild(e))),n.querySelectorAll("select.select").forEach((e=>e.parentElement?.removeChild(e))),n.querySelectorAll('input[type="text"]').forEach((e=>e.parentElement?.removeChild(e))),n.querySelectorAll(".subquestion").forEach((e=>e.parentElement?.removeChild(e))),n.querySelectorAll(".feedbackspan").forEach((e=>e.parentElement?.removeChild(e))),n.querySelectorAll(".specificfeedback").forEach((e=>e.parentElement?.removeChild(e))),n.querySelectorAll(".outcome").forEach((e=>e.parentElement?.removeChild(e))),n.querySelectorAll(".accesshide").forEach((e=>e.parentElement?.removeChild(e))),this.identityInternal=(0,h.identity)(n.innerText);for(const e of this.subquestions.values())this.identityInternal=(0,h.compoundIdentity)(this.identityInternal,e.getIdentity())}serializeToJSON(){const e=[];for(const t of this.subquestions.values())e.push(t.serializeToJSON());return{...super.serializeToJSON(),formulation:{html:this.formulation,images:this.formulationImages},subquestions:e,feedback:this.getFeedback()}}createWidgetAnchor(e){const t=this.subquestions.get(e.index);return void 0===t||t.__type!=e.__type?null:t.createWidgetAnchor(e.anchor)}getOrphanContainers(){const e=[];for(const t of this.subquestions.values())e.push(...t.getOrphanContainers());return e}get identity(){return this.identityInternal.toString()}get autofillSupported(){return!0}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=y},4369:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ContainerWrapper=void 0;const s=n(67),r=n(4963),o=n(2229),a=i(n(9358)),l=n(1641),c=n(254),u=n(4963);class d{constructor(e,t){this.images=[],this.anchor=[],this._wanded=!1,this.control=e,this.container=t,this.parent=(0,c.checkNotNull)(e.parentElement,"AnswerOption: Missing control's parent element");const n=(0,c.checkNotNull)(e.labels,"AnswerOption: Control is hidden");if(0==n.length){const t=(0,c.checkNotNull)(e.getAttribute("aria-labelledby"),"AnswerOption: Control doesn't have aria-labelledby"),n=t.replace(":","\\:");this.label=(0,c.checkNotNull)(this.container.querySelector("#"+n),`AnswerOption: Label '${t}' not found`)}else this.label=n[0];let i;const s=this.label.querySelector(".answernumber");if(null!==s){const e=(0,c.checkNotNull)(this.label.lastChild,"AnswerOption: Label doesn't have children");if(s===e)throw Error("AnswerOption: Label contains only number");e instanceof HTMLElement?(i=(0,r.strip)(e.innerText),this.textHtml=e.innerHTML):(i=(0,r.strip)(e.textContent||""),this.textHtml=i)}else i=(0,r.strip)(this.label.innerText),this.textHtml=this.label.innerHTML;""!==i&&(this.anchor.push(i),this.identity=(0,u.identity)(i)),this.label.querySelectorAll("img").forEach((e=>{const t=(0,o.fromImageElementLazy)(e);this.images.push(t),this.identity=(0,r.compoundIdentity)(this.identity,(0,u.identity)((0,o.getSrcFilename)(t)));const n=(0,r.extractFilenameFromUrl)(t.src);n&&this.anchor.push(n)}))}getControl(){return this.control}serializeToJson(){return{html:this.textHtml,images:this.images,userInput:{checked:this.control.checked,state:(0,s.getStateFromClassList)(this.parent)}}}createWidgetContainer(){return this._wanded=!0,this.parent}setChecked(e){this.control.checked=e}getAnchor(){return this.anchor}getIdentity(){return this.identity}get wanded(){return this._wanded}}class h{constructor(e){this.answerOptions=[],this._wanded=!1,this.container=e;const t=e.querySelectorAll('input[type="radio"]'),n=e.querySelectorAll('input[type="checkbox"]');if(t.length>0)this.multipleAnswersAllowed=!1,t.forEach((t=>{t instanceof HTMLInputElement&&this.answerOptions.push(new d(t,e))}));else{if(!(n.length>0))throw Error("Could not parse multichoice question: input elements are not found");this.multipleAnswersAllowed=!0,n.forEach((t=>{t instanceof HTMLInputElement&&this.answerOptions.push(new d(t,e))}))}}getOptions(){return this.answerOptions.map((e=>e.serializeToJson()))}getIdentity(){return(0,r.compoundIdentity)(...this.answerOptions.map((e=>e.getIdentity())))}getOrphanContainers(){const e=[];if(this.multipleAnswersAllowed)for(const t of this.answerOptions)t.wanded||e.push({container:t.createWidgetContainer(),appendPosition:"after"});else this._wanded||e.push({container:this.container,appendPosition:"after"});return e}createWidgetAnchor(e){if(this.multipleAnswersAllowed){const t=(0,l.fuzzyAnchor)(e,this.answerOptions.map((e=>e.getAnchor())));if(-1===t)return null;const n=this.answerOptions[t];return{onApply:e=>{const t=e.checked;void 0!==t?n.setChecked(t):a.default.warn("Multichoice (checkbox): Could not autofill solution: missing checked flag")},container:n.createWidgetContainer(),appendPosition:"after"}}{const e=e=>{const t=e.anchor;if(void 0===t)return void a.default.warn("Multichoice (radio): Could not autofill solution: missing anchor");const n=(0,l.fuzzyAnchor)(t,this.answerOptions.map((e=>e.getAnchor())));-1!==n&&this.answerOptions[n]?.setChecked(!0)};return this._wanded=!0,{onApply:e,container:this.container,appendPosition:"after"}}}}t.ContainerWrapper=h;class p extends s.Question{constructor(e){super(e);const t=(0,c.checkNotNull)(this.container.querySelector("div.answer"),"Missing .answer");this.wrapper=new h(t),this.formulation=new s.QTextWrapper(e)}serializeToJSON(){return{...super.serializeToJSON(),formulation:this.formulation.getFormulation(),options:this.wrapper.getOptions(),feedback:this.getFeedback(),single:!this.wrapper.multipleAnswersAllowed}}getOrphanContainers(){return this.wrapper.getOrphanContainers()}createWidgetAnchor(e){return this.wrapper.createWidgetAnchor(e)}get identity(){return(0,r.compoundIdentity)(this.formulation.getIdentity(),this.wrapper.getIdentity()).toString()}get autofillSupported(){return!0}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=p},67:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Question=t.QTextWrapper=t.isSolution=t.getStateFromClassList=t.State=void 0;const s=n(9766),r=i(n(6815)),o=n(2229),a=i(n(1877)),l=n(1420),c=n(7744),u=n(254),d=n(4963),h=i(n(9358));var p;!function(e){e[e.Unknown=-1]="Unknown",e[e.Incorrect=0]="Incorrect",e[e.PartiallyCorrect=1]="PartiallyCorrect",e[e.Correct=2]="Correct"}(p=t.State||(t.State={})),t.getStateFromClassList=function(e){const t=e.classList;return t.contains("incorrect")?p.Incorrect:t.contains("prtiallycorrect")?p.PartiallyCorrect:t.contains("correct")?p.Correct:p.Unknown},t.isSolution=function(e){return(0,c.isObject)(e)&&"anchor"in e},t.QTextWrapper=class{constructor(e){this.formulationImages=[];const t=(0,u.checkNotNull)(e.querySelector(".qtext"),"Missing .qtext");this.formulation=t.innerHTML,t.querySelectorAll("img").forEach((e=>{const t=(0,o.fromImageElementLazy)(e);this.formulationImages.push(t)}));const n=t.cloneNode(!0);n.querySelectorAll(".accesshide").forEach((e=>e.parentElement?.removeChild(e))),this.identity=(0,d.identity)(n.innerText)}getFormulation(){return{html:this.formulation,images:this.formulationImages}}getIdentity(){return this.identity}},t.Question=class{constructor(e){this.id=null,this.grade=[];const t=e.classList;if(t.length<4)throw Error("Invalid question container: class list doesnt contain required data");const n=e.querySelector("input.questionflagpostdata");if(null!=n){const e=(0,u.checkIfInstance)(n,HTMLInputElement,"Question doesn't have details block"),t=new URL("a://a/a?"+e.value),i=(0,u.checkNotNull)(t.searchParams.get("qid"),"Question doesn't have an id");this.id=parseInt(i)}else h.default.info("Question doesn't have details block. Fallback to identity.");this.__type=t[1],this.behavior=t[2],this.state=t[3];const i=(0,u.checkNotNull)(e.querySelector("div.info"),"Could not locate .info block").querySelector("div.grade");if(i)for(const e of i.innerText.matchAll(/[0-9]\d*([.,]\d+)?/g))this.grade.push(parseFloat(e[0]));this.container=e}handleSolution(e,t){function n(e){const t={backColor:"rgba(228,225,237,0.44)",frontColor:"#5D616C"};switch(e){case p.Incorrect:t.backColor="rgba(255,221,227,0.87)",t.frontColor="#F93A5B";break;case p.PartiallyCorrect:t.backColor="rgba(254,245,212,0.67)",t.frontColor="#FA9A0F";break;case p.Correct:t.backColor="rgba(225,238,227,0.73)",t.frontColor="#27993A"}return t}const i=[],o=e.suggestions,u=e.submissions,d=e.suggestionsLock,h=this.createWidgetAnchor(e.anchor);if(!h)return;if((0,c.isObject)(d)){const e=()=>window.open(d.actionUrl,"_blank")?.focus();i.push({label:r.default.i18n.getMessage("magicMenuSuggestions"),icon:{name:["fa","fa-bolt"],alignRight:!1},subMenu:[{label:d.message,icon:{name:["fa","fa-lock"],alignRight:!0}},{label:d.actionText,icon:{name:["fa","fa-external-link"],alignRight:!0},action:e}]})}if(o&&o.length>0){const e={label:r.default.i18n.getMessage("magicMenuSuggestions"),icon:{name:["fa","fa-bolt"],alignRight:!1},subMenu:[]};o.forEach((t=>{this.autofillSupported?e.subMenu?.push({label:t.label,icon:{alignRight:!0,text:100*t.confidence+"%",...n(t.correctness)},action:()=>h.onApply(t.data)}):e.subMenu?.push({label:t.label,icon:{alignRight:!0,text:100*t.confidence+"%",...n(t.correctness)},subMenu:[{label:t.label,icon:{name:["fa","fa-copy"],alignRight:!0},action:()=>h.onApply(t.data)}]})})),i.push(e)}if(u&&u?.length>0){const e={label:r.default.i18n.getMessage("magicMenuSubmissions"),icon:{name:["fa","fa-bar-chart"],alignRight:!1},subMenu:[]};u.forEach((t=>{this.autofillSupported?e.subMenu?.push({label:t.label,icon:{alignRight:!0,text:t.count.toString(),...n(t.correctness)},action:()=>h.onApply(t.data)}):e.subMenu?.push({label:t.label,icon:{alignRight:!0,text:t.count.toString(),...n(t.correctness)},subMenu:[{label:t.label,icon:{name:["fa","fa-copy"],alignRight:!0},action:()=>h.onApply(t.data)}]})})),i.push(e)}const f=(0,l.wrapWithShadowDomHost)(h.container),g=f.attachShadow({mode:"closed"}),m=new a.default,b=new s.ContextMenu(i),y=(0,l.getFontAwesomeLink)();y?g.appendChild(y):m.element.innerText="[s]",b.attach(m,f);const w=document.createElement("slot");"before"==h.appendPosition?(g.appendChild(m.element),g.appendChild(w)):(g.appendChild(w),g.appendChild(m.element)),t.register(m)}handleOrphans(e,t){const n=[];n.push({label:t.message,icon:{name:t.icon,alignRight:!1}},{label:r.default.i18n.getMessage("documentation"),icon:{name:["fa","fa-external-link"],alignRight:!1},action:()=>window.open("https://syncshare.naloaty.me/no-magic-help","_blank")?.focus()});const i=this.getOrphanContainers();for(const r of i){const i=(0,l.wrapWithShadowDomHost)(r.container),o=i.attachShadow({mode:"closed"}),a=new t.button,c=new s.ContextMenu(n),u=(0,l.getFontAwesomeLink)();u?o.appendChild(u):a.element.innerText="[s]",c.attach(a,i);const d=document.createElement("slot");"before"==r.appendPosition?(o.appendChild(a.element),o.appendChild(d)):(o.appendChild(d),o.appendChild(a.element)),e.register(a)}}serializeToJSON(){return{id:this.id,__type:this.__type,behavior:this.behavior,state:this.state,grade:this.grade,identity:this.identity}}}},436:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(8506)),l=r(n(1692)),c=r(n(4369)),u=r(n(7759)),d=r(n(1292)),h=r(n(8911)),p=o(n(9358)),f=n(7979);t.default=class{parse(e){try{switch(e.classList[1]){case f.QuestionType.Match:return new a.Parser(e);case f.QuestionType.Multianswer:case f.QuestionType.GapFill:case f.QuestionType.GapSelect:return new l.Parser(e);case f.QuestionType.Multichoice:case f.QuestionType.MultichoiceSet:case f.QuestionType.TrueFalse:return new c.Parser(e);case f.QuestionType.Shortanswer:case f.QuestionType.Numerical:return new u.Parser(e);case f.QuestionType.Coderunner:return new d.Parser(e);default:return p.default.warn("Unknown question type:",e.classList[1]),new h.Parser(e)}}catch(t){p.default.error("Could not parse question",{error:t,extra:{html:e.outerHTML}})}return null}}},7759:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ControlWrapper=void 0;const i=n(67),s=n(254);class r{constructor(e){this._wanded=!1,this.control=e}createWidgetAnchor(){const e=(0,s.checkNotNull)(this.control.parentElement,"Missing control's parent");return this._wanded=!0,{container:e,onApply:e=>this.control.value=e,appendPosition:"after"}}getOrphanContainers(){return this._wanded?[]:[{container:(0,s.checkNotNull)(this.control.parentElement,"Missing control's parent"),appendPosition:"after"}]}getUserInput(){return{value:this.control.value,state:(0,i.getStateFromClassList)(this.control)}}}t.ControlWrapper=r;class o extends i.Question{constructor(e){super(e);const t=(0,s.checkNotNull)(this.container.querySelector('input[type="text"]'),"Missing input field");this.wrapper=new r(t),this.formulation=new i.QTextWrapper(e)}createWidgetAnchor(){return this.wrapper.createWidgetAnchor()}getOrphanContainers(){return this.wrapper.getOrphanContainers()}get autofillSupported(){return!0}get identity(){return this.formulation.getIdentity().toString()}serializeToJSON(){return{...super.serializeToJSON(),formulation:this.formulation.getFormulation(),userInput:this.wrapper.getUserInput(),feedback:this.getFeedback()}}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=o},8911:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const i=n(67);class s extends i.Question{constructor(e){super(e),this.wandContainer=this.container.querySelector("div.formulation")||this.container}serializeToJSON(){return{id:-1,__type:"unsupported",behavior:"",state:"",grade:[],identity:""}}getOrphanContainers(){return[{container:this.wandContainer,appendPosition:"after"}]}createWidgetAnchor(){return null}get identity(){return""}get autofillSupported(){return!1}}t.Parser=s},7996:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=o(n(436)),l=o(n(9358)),c=n(67),u=o(n(1857)),d=o(n(859)),h=n(183),p=o(n(7011)),f=o(n(6606)),g=o(n(4945)),m=o(n(197)),b=o(n(6248)),y=o(n(6329)),w=o(n(840)),v=n(5041),_=o(n(6077)),S=o(n(6815)),M=r(n(2176)),O=o(n(3897)),k=n(2938),C=n(5045),x=n(4139),q=n(3793),A=o(n(812)),E=o(n(2894)),T=n(8911);C.Tracker.init();class I{constructor(e){this.bus=e,this.questions=[],this.incorrectQuestions=[]}get meta(){return this._meta}async init(){const e=new _.default,t=new h.MultiSource;t.add(new b.default,1),t.add(new w.default,2),t.add(new y.default,3),t.add(new g.default,4),t.add(new m.default,5),t.add(new p.default,6),t.add(new f.default,1),await e.load(),await t.load();const n=new h.MultiSource;n.add(t,1),n.add(e,2),e.get("attemptId")!==t.get("attemptId")&&(await S.default.storage.local.remove("magicButtonsState"),l.default.info("QuizPage: Magic buttons state invalidated"));const i=new M.default(t,e);await i.invalidate()&&(l.default.info("QuizPage: Attempt context invalidated"),new O.default(M.PARALLEL_ATTEMPTS_WARNING).show()),this._meta={host:n.get("host"),courseId:n.get("courseId"),courseName:n.get("courseName"),quizId:n.get("quizId"),quizName:n.get("quizName"),attemptId:n.get("attemptId"),moodleId:n.get("moodleId")},this._meta.host&&(C.Tracker.moodleHost=this._meta.host),e.saveAttemptData(this._meta),this.magicButtonRegistry=new v.MagicButtonRegistry,await this.magicButtonRegistry.init(this.bus);const s=new a.default;document.querySelectorAll("div.que").forEach((e=>{if(!(e instanceof HTMLDivElement))return;const t=s.parse(e);t&&(t instanceof T.Parser?this.incorrectQuestions.push(t):this.questions.push(t))}))}processAttempt(){for(const e of this.questions)this.bus.publishToBackground(d.default.SolutionRequest,{questionId:e.id,questionType:e.__type,questionIdentity:e.identity,quizMeta:this._meta}).then((t=>{if(t)if((0,k.isArray)(t,q.isUnknown))for(const n of t)(0,c.isSolution)(n)?e.handleSolution(n,this.magicButtonRegistry):l.default.warn("Invalid solution response: unrecognized object",n);else l.default.error("Invalid solution response: expected an array but got something else",{},t)})).catch((e=>{l.default.error("Error during solution request",{error:e})})).finally((()=>{const t={message:S.default.i18n.getMessage("noQuestionSolution"),icon:["fa","fa-clock-o"],button:A.default};e.handleOrphans(this.magicButtonRegistry,t)}));for(const e of this.incorrectQuestions){const t={message:S.default.i18n.getMessage("questionNotSupportedMessage"),icon:["fa","fa-wrench"],button:E.default};e.handleOrphans(this.magicButtonRegistry,t)}window.addEventListener("beforeunload",(e=>{this.bus.publishToBackground(d.default.QuizAttemptData,{quizMeta:this._meta,questions:this.questions.map((e=>e.serializeToJSON()))})}))}processReview(){const e=document.querySelector("table.quizreviewsummary");this.bus.publishToBackground(d.default.QuizReviewData,{quizMeta:this._meta,reviewSummary:e?.innerHTML||null,questions:this.questions.map((e=>e.serializeToJSON()))})}}!async function(){const e=u.default.getInstance(),t=new x.AuthServiceContent(e),n=new I(e);await n.init(),l.default.info("QuizPage: Checking page for compatibility...");let i=!0;for(const[e,t]of Object.entries(n.meta))null===n.meta[e]&&(l.default.warn(`QuizPage: Missing required parameter '${e}'`),i=!1);if(i)if(l.default.info("QuizPage: Yay, page can be served ^_^"),document.querySelector("#page-mod-quiz-review")){l.default.info("QuizPage: Serving as a review"),n.processReview();const e=await t.getAuthData();null!=e&&e.shortLived&&await t.logout()}else l.default.info("QuizPage: Serving as an attempt"),n.processAttempt();else l.default.info("QuizPage: Sorry, page is not compatible.")}()},6329:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(980));class r extends s.default{async load(){const e=document.querySelector("a.endtestlink.aalink");if(e instanceof HTMLAnchorElement){const t=new URL(e.href),n=t.searchParams.get("cmid"),i=t.searchParams.get("attempt");n&&(this.data.quizId=parseInt(n)),i&&(this.data.attemptId=parseInt(i))}}}t.default=r},7979:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.QuestionType=void 0,(n=t.QuestionType||(t.QuestionType={})).Match="match",n.Multichoice="multichoice",n.MultichoiceSet="multichoiceset",n.Shortanswer="shortanswer",n.Numerical="numerical",n.Multianswer="multianswer",n.GapSelect="gapselect",n.Coderunner="coderunner",n.GapFill="gapfill",n.TrueFalse="truefalse"}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=t,e=[],i.O=(t,n,s,r)=>{if(!n){var o=1/0;for(u=0;u<e.length;u++){for(var[n,s,r]=e[u],a=!0,l=0;l<n.length;l++)(!1&r||o>=r)&&Object.keys(i.O).every((e=>i.O[e](n[l])))?n.splice(l--,1):(a=!1,r<o&&(o=r));if(a){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[n,s,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=726,(()=>{var e={726:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,r,[o,a,l]=n,c=0;if(o.some((t=>0!==e[t]))){for(s in a)i.o(a,s)&&(i.m[s]=a[s]);if(l)var u=l(i)}for(t&&t(n);c<o.length;c++)r=o[c],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(u)},n=self.webpackChunksyncshare_extension=self.webpackChunksyncshare_extension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=i.O(void 0,[223],(()=>i(7996)));s=i.O(s)})();